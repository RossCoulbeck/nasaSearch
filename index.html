<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Nasa Image Viewer</title>

		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

		<link rel="stylesheet" href="css/reset.css" />
		<link rel="stylesheet" href="css/main.css" />
		<link rel="shortcut icon" href="./favicon.ico">

		<link href="https://fonts.googleapis.com/css?family=Montserrat|Open+Sans" rel="stylesheet">

		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.1/css/all.css" integrity="sha384-O8whS3fhG2OnA5Kas0Y9l3cfpmYjapjI0E4theH4iuMD+pLhbf6JI0jIMfYcK3yZ" crossorigin="anonymous">

		<!--Allows older browsers to use HTML5 elements-->
		<!--[if lt IE 9]>
	    <script src="js/html5shiv.js"></script>
		<![endif]-->

		<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
	</head>
	<body>
		<div class="popupOverlay">
			<div class="popup">
				<div class="popup__close"><i class="far fa-times-circle"></i></div>

				<h2 class="popup__assetTitle"></h2>
				
				<p class="popup__assetDesc"></p>

				<img src="" alt="" class="popup__assetImage">
			</div>
		</div>
		<header>
			<div class="logo">
				<img src="images/logo.png" alt="nasa logo">
			</div>
		</header>
		<section class="mainContainer">
			<h1>NASA Search</h1>

			<div class="searchBox">

				<div class="searchBox__searchContainer">
					<input type="search" class="searchBox__text" />
					<i class="fas fa-search searchBox__icon"></i>
				</div>

				<div class="searchBox__checkContainer">
					<input type="checkbox" class="searchBox__check" id="imageCheck" />
					<span class="searchBox__fakeCheck" id="imageCheckFake"><i class="fas fa-check"></i></span>
					<label for="imageCheck" id="imageCheckLabel" class="searchBox__checkLabel">Image</label>
				</div>
				
				<div class="searchBox__checkContainer">
					<input type="checkbox" class="searchBox__check" id="audioCheck" />
					<span class="searchBox__fakeCheck" id="audioCheckFake"><i class="fas fa-check"></i></span>
					<label for="audioCheck" id="audioCheckLabel" class="searchBox__checkLabel">Audio</label>
				</div>
			</div>
			
			<div class="imageGrid"></div>
			
		</section>

		<script>
		$( document ).ready(function() {
			$('#imageCheckLabel, #imageCheckFake').on('click', function() {
				$('#imageCheckFake').toggleClass('checked');
			})

			$('#audioCheckLabel, #audioCheckFake').on('click', function() {
				$('#audioCheckFake').toggleClass('checked');
			})

			$('.searchBox__icon').on('click', function() {
				searchNasa();
			});

			$('.searchBox__text').on('keyup', function(event) {
				if (event.keyCode === 13) {
					searchNasa();
				}
			})

			$('.imageGrid').on('click', '.imageGrid__image', function() {
				var nasaID = $(this).data("nasaid");
				var title = $(this).data("title");;
				var desc = $(this).data("desc");;

				retrieveAsset(nasaID, title, desc);
			})

			$('.popup__close').on('click', function() {
				$('.popupOverlay').css('display', 'none');
			})
			
		});

		function searchNasa() {
			var imageResultHTML = "";
			var searchTerm = $('.searchBox__text').val();

			$.get("https://images-api.nasa.gov/search?q="+ searchTerm + "&media_type=image", function(data, status){
				//console.log(data);

				$(data.collection.items).each(function(index, el){
					console.log(el);

					imageResultHTML += '<div class="imageGrid__image" data-nasaID="' + el.data[0].nasa_id + '" data-title="' + el.data[0].title + '" data-desc="' + el.data[0].description + '"><img src="' + el.links[0].href + '" alt=""><div class="imageGrid__imageOverlay"><i class="fas fa-search-plus"></i></div></div>'
				});

				$('.imageGrid').html(imageResultHTML);
			});
		}

		function retrieveAsset(nasaID, title, desc) {
			clearPopup();

			$.get("https://images-api.nasa.gov/asset/" + nasaID, function(data, status){
				var asset = data.collection.items[3].href;
				
				$('.popup__assetImage').attr("src", asset);
			});

			$('.popup__assetTitle').text(title);
			$('.popup__assetDesc').text(desc);

			$('.popupOverlay').css('display', 'flex');
		}

		function clearPopup() {
			$('.popup__assetTitle').text("");
			$('.popup__assetDesc').text("");
			$('.popup__assetImage').attr("src", "");
		}
		</script>
	</body>
</html>